# Manus Cloud Pro 

## 安全改进说明

### 🔒 已修复的安全问题

1. **硬编码密钥** → 环境变量配置
2. **弱密码存储** → bcrypt 哈希 (12轮盐值)
3. **路径穿越攻击** → 严格路径验证
4. **文件上传漏洞** → 类型/大小/名称检查
5. **暴力破解** → 请求频率限制
6. **信息泄露** → 安全错误处理
7. **缺少安全头** → Helmet 中间件
8. **分享系统漏洞** → 权限验证修复

### 🚀 快速启动

1. **安装依赖**
   ```bash
   npm install
   ```

2. **配置环境变量**
   ```bash
   cp .env.example .env
   # 编辑 .env 文件，设置安全的密钥
   ```

3. **生成安全密钥**
   ```bash
   node -e "console.log('JWT_SECRET=' + require('crypto').randomBytes(32).toString('hex'))"
   node -e "console.log('ENCRYPTION_SALT=' + require('crypto').randomBytes(16).toString('hex'))"
   ```

4. **启动服务**
   ```bash
   node server.js
   ```

### 🛡️ 安全特性

- **认证安全**: JWT + bcrypt 密码存储
- **文件安全**: 路径验证 + 类型检查 + 大小限制
- **访问控制**: 用户隔离 + 权限验证
- **攻击防护**: 频率限制 + 输入验证 + 安全头
- **审计日志**: 安全事件记录
- **加密存储**: AES-256 文件加密

### 📝 配置说明

| 环境变量 | 说明 | 默认值 |
|---------|------|--------|
| `JWT_SECRET` | JWT 签名密钥 | 必填 |
| `ENCRYPTION_SALT` | 文件加密盐值 | 必填 |
| `PORT` | 服务端口 | 8000 |
| `SESSION_EXPIRES_IN` | 会话有效期(天) | 30 |
| `MAX_FILE_SIZE` | 最大文件大小(MB) | 100 |
| `ALLOWED_FILE_TYPES` | 允许的文件类型 | 见配置 |
| `ENABLE_HTTPS` | 启用 HTTPS | false |

### ⚠️ 安全建议

1. **生产环境必须**:
   - 使用强密码作为 JWT_SECRET
   - 启用 HTTPS
   - 配置防火墙
   - 定期备份数据

2. **文件安全**:
   - 限制可执行文件上传
   - 定期扫描病毒
   - 监控存储空间

3. **访问控制**:
   - 使用反向代理
   - 配置访问白名单
   - 启用日志监控

### 🔧 故障排除

- **启动失败**: 检查环境变量配置
- **无法登录**: 查看安全日志
- **文件上传失败**: 检查文件类型和大小限制

---

**注意**: 此版本已大幅提升安全性，但请根据实际使用场景进行进一步安全配置。
**注意**：预留了APP接口以提供开发者使用
